<html>
<head>
<!--<script type="text/javascript" src="main/scripts/jquery-3.3.1.min.js">-->
</script>
	
<script> 

var Player = function(name){
	this.name = name;
	this.age = '18';
	this.health = 100;
	this.getHealth = function() {
		return "Здоровье:" + this.health + "%";
	}
	this.bodyStatus = ['Стоит','Сидит','Лежит'];
	this.currentBodyStatus = 0;
	
	function Actions(id,name) {
		this.id = id;
		this.name = name;
		this.available = true;
		this.activate = function () {
			this.available = true;
		}
		this.deactivate = function () {
			this.available = false;
		}
		this.flag = false;
	}
	this.actionsArray = [];
	this.actionsArray[0] = new Actions ('0','Прилечь');
	this.lie = this.actionsArray[0];
	this.actionsArray[1] = new Actions ('1','Присесть');
	this.sit = this.actionsArray[1];
	this.actionsArray[2] = new Actions ('2','Встать');
	this.getup = this.actionsArray[2];
	this.actionsArray[3] = new Actions ('3','Подпрыгнуть');
	this.jump = this.actionsArray[3];
	this.actionsArray[4] = new Actions ('4','Открыть+1');
	this.open = this.actionsArray[4];
	this.actionsArray[5] = new Actions ('5','Взять+1');
	this.take = this.actionsArray[5];
	this.actionsArray[6] = new Actions ('6','Осмотреть+1');
	this.inspect = this.actionsArray[6];
	this.actionsArray[7] = new Actions ('7','Вставить+2');
	this.insert = this.actionsArray[7];
	

}

var Room = function(title, adress, startText) {
	this.title = title;
	this.adress = adress;
	this.img = 'none';
	this.text = startText;
	this.setText = function(text) {
		this.text = text;
	}
	this.activeObjectsArray = [];
}

function ActiveObject (id,name,active) {
	this.id = id;
	this.name = name;
	this.available;
	this.isUsed = false;
	if (typeof active != 'undefined') {
		this.available = active;
	}
	else {
		this.available = true;
	}
	this.activate = function () {
		this.available = true;
	}
	this.deactivate = function () {
		this.available = false;
	}
}

//функция обновления текста
function addText (text) {
	actualText.innerHTML += '@<p>'+text+'</p>';
	actualText.scrollTop = actualText.scrollHeight;
}

function new_game() {
	document.getElementById("main-menu").style.display = "none";
	
	//Создаем нового игрока
	
	//Запускаем игрока в комнату
	first_room();
}



//Создаем комнату
function first_room() {
	var player = new Player('Сычев');
	//Наполняем комнату
	var room_test = new Room('Клетка Сыча','Этаж 522, сектор Г', 'Вы в пустой комнате. Стальная дверь без ручки без замка. Обычное пластиковое окно с подоконником, но за окном - кирпичная кладка. На полу ковер.<br>');
	room_test.img = 'img/back/lol5.png';
	//наполняем интерфейс
	var main_w = document.getElementById('main-div');
	main_w.style.backgroundImage = backgroundImage = "url("+room_test.img+")";;
	
	var room_title = document.createElement('div');
	room_title.id = 'room_title';
	room_title.className +=" pre";
	main_w.appendChild(room_title);
	room_title.innerHTML = room_test.title + ' : ' + room_test.adress;
	
	var room_image = document.createElement('div');
	room_image.id = 'room_image';
	//room_image.className +=" pre";
	
	main_w.appendChild(room_image);
	//room_image.innerHTML = '<img src="' + room_test.img + '">'
	
	var room_image_padding = document.createElement('div');
	room_image_padding.id = 'room_image_padding';
	room_image_padding.className +=" pre";
	room_image.appendChild(room_image_padding);
	
	var room_textArea = document.createElement('div');
	room_textArea.id = 'room_textArea';
	room_textArea.className +=" pre";
	room_image.appendChild(room_textArea);
	
		var actualText_back = document.createElement('div');
		actualText_back.id = 'actualText_back';
		room_textArea.appendChild(actualText_back);
		
		var actualText = document.createElement('div');
		actualText.id = 'actualText';
		actualText.className +=" pre";
		actualText.innerHTML = room_test.text;
		room_textArea.appendChild(actualText);
		
		var playerStatus_back = document.createElement('div');
		playerStatus_back.id = 'playerStatus_back';
		playerStatus_back.className +=" pre";
		room_textArea.appendChild(playerStatus_back);
		
		var playerStatus = document.createElement('div');
		playerStatus.id = 'playerStatus';
		playerStatus.className +=" pre";
		room_textArea.appendChild(playerStatus);
			
			var namePlayerStatus = document.createElement('div');
			namePlayerStatus.id = 'namePlayerStatus';
			namePlayerStatus.className = "pre";
			namePlayerStatus.innerHTML = player.name;
			playerStatus.appendChild(namePlayerStatus);
			
			var healthPlayerStatus = document.createElement('div');
			healthPlayerStatus.id = 'healthPlayerStatus';
			healthPlayerStatus.className = "pre";
			healthPlayerStatus.innerHTML = player.getHealth();
			playerStatus.appendChild(healthPlayerStatus);
			
			var bodyPlayerStatus = document.createElement('div');
			bodyPlayerStatus.id = 'bodyPlayerStatus';
			bodyPlayerStatus.className = "pre";
			bodyPlayerStatus.innerHTML = player.bodyStatus[0];
			playerStatus.appendChild(bodyPlayerStatus);
	
	var room_actions = document.createElement('div');
	room_actions.id = 'room_actions';
	room_actions.className +=" pre";
	room_image.appendChild(room_actions);
		
		var playerActions = document.createElement('div');
		playerActions.id = 'playerActions';
		playerActions.className +=" pre";
		room_actions.appendChild(playerActions);
		
		var roomActions = document.createElement('div');
		roomActions.id = 'roomActions';
		roomActions.className +=" pre";
		room_actions.appendChild(roomActions);

	
	//распихиваем действия игрока по кнопкам
	function check_actions() {
		playerActions.innerHTML = '';
		for (i=0;i<player.actionsArray.length;i++) {
			if (player.actionsArray[i].available == true) {
				var button = document.createElement('div');
				button.id = 'action'+player.actionsArray[i].id;
				button.className = "button pre";
				button.style.position = "absolute";
				button.style.height = "25px";
				button.style.width = "140px";
				if (i % 2) {
					button.style.left = "160px";
					button.style.top = (i-1) * 20 + 4 + 'px';
				}
				else {
					button.style.left = "5px";
					button.style.top = i * 20 + 4 + 'px';
				}
				playerActions.appendChild(button);
				button.innerHTML = player.actionsArray[i].name;
				//if (i % 2) room_actions.innerHTML += '<br>';
			}
		}
	}
	check_actions();
	function lie() {
		if (player.currentBodyStatus == 2) {
			actualText.innerHTML += "@<p>Вы уже лежите</p>"
		}
		else {
			player.currentBodyStatus = 2;
			bodyPlayerStatus.innerHTML = player.bodyStatus[2];
			addText("Вы легли");
		}
	}
	function getUp() {
		if (player.currentBodyStatus == 0) {
			addText("Вы уже стоите");
		}
		else {
			player.currentBodyStatus = 0;
			bodyPlayerStatus.innerHTML = player.bodyStatus[0];
			addText("Вы встали");
		}
	}
	var sitcount =0;
	function sit() {
		sitcount
		if (player.currentBodyStatus == 1) {
			if (sitcount == 2) {
				addText("Фуфлыжно сидите!");
			}
			else if (sitcount == 3) {
				addText("Как фуфел!!!");
			}
			else {
				addText("Вы уже сидите");
			}
			sitcount++;
		}
		else {
			player.currentBodyStatus = 1;
			bodyPlayerStatus.innerHTML = player.bodyStatus[1];
			addText("Вы сели");
			sitcount = 1;
		}
	}
	function jump() {
		player.currentBodyStatus = 0;
		bodyPlayerStatus.innerHTML = player.bodyStatus[0];
		addText("Вы подпрыгнули. Ничего не произошло");
	}
	
	//активируем действия для объектов
	function use(action_id,elem) {
		switch (action_id) {
		case '4':
			player.open.flag = true;
			player.take.flag = false;
			player.inspect.flag = false;
			player.insert.flag = false;
			break;
		case '5':
			player.open.flag = false;
			player.take.flag = true;
			player.inspect.flag = false;
			player.insert.flag = false;
			break;
		case '6':
			player.open.flag = false;
			player.take.flag = false;
			player.inspect.flag = true;
			player.insert.flag = false;
			break;
		case '7':
			player.open.flag = false;
			player.take.flag = false;
			player.inspect.flag = false;
			player.insert.flag = true;
			break;
		} 
		//красим только активированное действие			
		elements = document.getElementsByClassName('button_flaged')
		if (elem.className == "pre button_flaged") {
			for (i=0;i<elements.length;i++) {
				elements[i].className = "pre button";
			}
			player.open.flag = false;
			player.take.flag = false;
			player.inspect.flag = false;
			player.insert.flag = false;
		}
		else {
			//alert(elem.className);
			for (i=0;i<elements.length;i++) {
				elements[i].className = "pre button";
			}
			elem.className = "pre button_flaged";
			
		}
	}
	
	document.getElementById('action'+player.lie.id).onclick=function(){ lie(); };
	document.getElementById('action'+player.getup.id).onclick=function(){ getUp(); };
	document.getElementById('action'+player.sit.id).onclick=function(){ sit(); };
	document.getElementById('action'+player.jump.id).onclick=function(){ jump(); };
	document.getElementById('action'+player.open.id).onclick=function(){ use(player.open.id,this); };
	document.getElementById('action'+player.take.id).onclick=function(){ use(player.take.id,this); };
	document.getElementById('action'+player.inspect.id).onclick=function(){ use(player.inspect.id,this); };
	document.getElementById('action'+player.insert.id).onclick=function(){ use(player.insert.id,this); };
	
	//Распихиваем объектры для взаимодействия
	room_test.activeObjectsArray[0] = new ActiveObject(0,'дверь',true);
	room_test.activeObjectsArray[1] = new ActiveObject(1,'окно',true);
	room_test.activeObjectsArray[2] = new ActiveObject(2,'ковер',true);
	room_test.activeObjectsArray[3] = new ActiveObject(3,'подоконник',false);
	room_test.activeObjectsArray[4] = new ActiveObject(4,'записка',false);

	
	//расставляем кнопки объектов в комнате
	function check_roomObjects () {
		roomActions.innerHTML = '';
		for (i=0;i<room_test.activeObjectsArray.length;i++) {
			if (room_test.activeObjectsArray[i].available == true) {
				var button = document.createElement('div');
				button.id = 'actionRoom'+room_test.activeObjectsArray[i].id;
				button.className = "button pre";
				button.style.position = "absolute";
				button.style.height = "25px";
				button.style.width = "140px";
				if (i % 2) {
					button.style.left = "160px";
					button.style.top = (i-1) * 20 + 4 + 'px';
				}
				else {
					button.style.left = "5px";
					button.style.top = i * 20 + 4 + 'px';
				}
				
				roomActions.appendChild(button);
				button.innerHTML = room_test.activeObjectsArray[i].name;
			}
		}
		document.getElementById('actionRoom'+room_test.activeObjectsArray[0].id).onclick=function(){ door(); };
		document.getElementById('actionRoom'+room_test.activeObjectsArray[1].id).onclick=function(){ window(); };
		document.getElementById('actionRoom'+room_test.activeObjectsArray[2].id).onclick=function(){ carpet(); };
	}
	check_roomObjects();
	
	
	
	function door() {
		if (player.open.flag == true) {
			addText('Дверь заперта');
		}
		if (player.take.flag == true) {
			addText('Ничего не выйдет');
		}
		if (player.inspect.flag == true) {
			addText('Железная дверь без ручек и замков. Выглядит достаточно прочной');
		}
		if (player.insert.flag == true) {
			addText('Что бы вставить?');
		}
	}
	function window() {
		if (player.open.flag == true) {
			addText('Окно закрыто');
		}
		if (player.take.flag == true) {
			addText('Ничего не выйдет');
		}
		if (player.inspect.flag == true) {
			addText('За окном кирпичная кладка. Стекло треснуто.');
			room_test.activeObjectsArray[3].available = true;
			check_roomObjects();
			document.getElementById('actionRoom'+room_test.activeObjectsArray[3].id).onclick=function(){ window_down(); };
		}
		if (player.insert.flag == true) {
			addText('Что бы вставить?');
		}
	}
	function window_down() {
		if (player.open.flag == true) {
			addText('Что открыть?');
		}
		if (player.take.flag == true) {
			addText('Нечего взять');
		}
		if (player.inspect.flag == true) {
			if (player.currentBodyStatus == 1) {
				addText('Под подоконником в монтажной пене торчит карточка');
			}
			else {
				addText('На подоконнике кровавые отпечатки пальцев.');
			}
		}
		if (player.insert.flag == true) {
			addText('Что бы вставить?');
		}
	}
	function carpet() {
		if (player.open.flag == true) {
			addText('Что открыть?');
		}
		if (player.take.flag == true) {
			addText('Под ковром записка.');
		}
		if (player.inspect.flag == true) {
			addText('Обычный персидский ковер. С пятнами крови.');
		}
		if (player.insert.flag == true) {
			addText('Что бы вставить?');
		}
	}
	
	
}


function load_game() {
	
}
</script>
<title>ВНИМАНИЕ НАЧИНАЕТСЯ САМОСБОР</title>
<link rel="stylesheet" href="css/minetheme.css">
</head>
<body>

<div id="main-div">
	<div id="main-menu" class="pre">
		<div class="button" onClick="new_game()">Новая игра</div>
		<!--<a class="a_button" onClick="load_game()" href="#">Загрузить игру</a>-->
	</div>
</div>

</body>
</html>
